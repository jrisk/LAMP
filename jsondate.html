<html>
<head>
    <title>JSON AGENDA VIEW BUILD 2.0</title>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script> 
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.14.30/js/bootstrap-datetimepicker.min.js"></script>
<script src="https://raw.githubusercontent.com/enyo/dropzone/master/dist/dropzone.js"></script>
<script src="./extrajs.js"></script>

<!-- testing purposes <script src="./testing.js"></script> -->
<!-- newest update makes downloadable build files automatically
<script src="https://modernizr.com/downloads/modernizr-latest.js" 
type="text/javascript"></script> -->

<link href="https://fonts.googleapis.com/css?family=Alegreya:400,700|Karla|Montserrat+Alternates:700" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/css/bootstrap-datetimepicker.min.css">
<link rel="stylesheet" href="./lessonplanner.css">
</head>

<body>
	<div id="json-today">TODAY'S DATE: </div>
	<div id="json-future">Future Plans</div>
	<div id="json-repeat"></div>
	<div id="json-past"></div>
	<div id="json-nest"></div>
	<h2 id="plans"></h2>

</body>
<script>
$(function () {

	$.ajax({
		type: 'GET',
		url: 'datesort.php',
		success: function(data) {

			var JSONParse = JSON.parse(data);

			console.log(JSONParse._proto_);

			//var prettyString = JSON.stringify(parseString, undefined, 2);

			//$('#json-nest').html(prettyString);

			// very memory intensive looping here...considering refactoring,redoing

			/*JSONParse.sort(function (a,b) { // YOU CAN ONLY SORT AND ARRAY
				// YOU CAN NOT SORT A JSON OBJECT!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
				return a.start - b.start;
			});*/

			var weekDays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

			console.log(JSONParse);

			$('#json-today').append(moment().format('dddd') + ' ' + moment().format('YYYY-MM-DD'));

			$.each(JSONParse, function(ind, obj) {

				//further seperate days into subplan-> activity combos

				for (i = 0; i < obj.length; i++) {

					var newtemp = obj[i].plan;

					if (newtemp == oldtemp) { // if current plan equals the last plan
						$('#' + stringpls).append('<h3 id="specificplan-' +
						obj[i].title + '" class="specplanners">' + obj[i].title + '</h3>');

					var oldtemp = obj[i].plan;

					}

					else { // if no match, it must be a new plan since its given in order

						//make sure any activity goes under the correct sub-div

						for (k = 0; k <= weekDays.length - 1; k++) {

							var planDate = ind;

							var Day = moment(planDate).format('dddd');

							var Today = moment().format('dddd');

							var fullToday = moment().format('YYYY-MM-DD');

						}

						var stringpls = 'planning' + newtemp.replace(/\s/g, '-');

						var titleParse = 'title: ' + obj[i].title.replace(/\s/g, '-');

						//If Today's Date is the same as one of the plans, put it in the first div 'json-today'

						if (planDate == fullToday) {

							$('#json-today').append('<h2 id="plan-day">'
							+ obj[0].date + '</h2>');

							$('#json-today').append('<h1 id="' + stringpls + '" class="plan-big well well-sm">' +
							newtemp + '</h1>');

							$('#' + stringpls).append('<h3 id="specificplan-'
							+ obj[i].title + '" class="specplanners the-first-act">'
							+ obj[i].title + '</h3>');

							var oldtemp = obj[i].plan;
						}

						// If The Plan is "more than today's date" or in the future, continue on to next div after today

						else if (planDate > fullToday) {

						$('#json-future').append('<div class="plan-day">'
							+ obj[0].date + '</div>');

						$('#json-future').append('<h1 id = "' + stringpls + '" class="plan-big well well-sm">'
							+ newtemp + '</h1>')

						$('#' + stringpls).append('<h3 id="specificplan-'
							+ obj[i].title + '" class="specplanners the-first-act">'
							+ obj[i].title + '</h3>');

						var oldtemp = obj[i].plan;

						}

						//If Today's Date is is more than the plan's date, the plan is in the past, and goes into the graveyard/purgatory
						//depending on if the plan has been made to be repeated every weekday that its on, or to other days

						else { // (planDate < fullToday)

						$('#json-past').append('<h2 id="plan-day">' + obj[0].date + '</h2>');

						$('#json-past').append('<h1 id="' + stringpls + '" class="plan-big well well-sm">'
							+ newtemp + '</h1>');

						$('#' + stringpls).append('<h3 id="specificplan-'
							+ obj[i].title + '" class="specplanners the-first-act">'
							+ obj[i].title + '</h3>');
							
							var oldtemp = obj[i].plan;
				
						}

						// If the Date isnt the same as Today but the Weekdays are, put in the weekday 'repeat' basket

						if (Day == Today) {
						///always use the g flag to match ALL occurences, not just the first one

						//need stringpls here

						$('#json-repeat').append('<h2>' + Today + '\'s Plans</h2>');
						$('#json-repeat').append('<h3>The Plans name is: ' + obj[0].plan + '</h3>');
						
						var oldtemp = obj[i].plan;
						//var todayplan = 1;
						}	
					}
				}

			});

			$('.plan-big *').hide(); //hide the activities of each plan

			$('.plan-big').on('click tap', function(e) { //show the activities on click
				e.preventDefault();
				$(this).children().toggle("slow");
			});
		},

		error: function(errorThrown) {
			$('#json-nest').html(errorThrown);
		}
	});

})
</script>

</html>

