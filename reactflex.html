<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="device=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <title>React Tutorial</title>
    <!-- Not present in the tutorial. Just for basic styling. -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>

    <style>

    @keyframes slider {
        0% {

        }

        25% {

        }
    }

    #weekView {
        -webkit-overflow-scrolling: touch;
    }
     
     .windowPane {
        display: flex;
        flex-flow: row nowrap;
        -webkit-flex-flow: row nowrap;
        padding-left: 0;
     }

     .weekDay {
        flex: 1;
        text-align: center;
        list-style: none;
        min-width: 100%;
        height: 100%;
        box-shadow: 0.2em 0.2em 0.2em #999;
     }
    
    .weekDay > .dayName {
        box-shadow: 0.2em 0.1em 0.1em #999;
    }

     .planWrap {
        /*display: inline; 
        text-align: center;
        max-width: 100%;
        max-height: 100%;*/
     }

    /* .dayName {
        font-size: 3em;
     }

     .timeWrap > h4 {
        font-size: 1em
     }

     .timeWrap > h2 {
        font-size: 2em
     } */

    #testdiv {
        z-index: 1000;
    }


    </style>

    <script>
    //this would be easier in jquery

    function testElem(test) {
        if (window) {
            test.innerHTML = "there is a window object";
        }

        if (document) {
        test.innerHTML += "there is a document object";
        }
        if (window.pageXOffset) {
            test.innerHTML += "the window x offset is = " + window.pageXOffset;
        }
        if (window.outerWidth) {
            test.innerHTML += "<hr> and the window outerwidth is = " + window.outerWidth;
        }
    }

    function _Scroller() {
        console.log('onScroller called');
        // now a scroll for mobile and onkeypress
    }

    function onScroller() {

        var hori = window.pageXOffset;
        var vert = window.pageYOffset;
        var viewWidth = window.outerWidth;

        var weekBoxes = document.getElementsByClassName('weekDay');

        var mondayOffSet = weekBoxes[0].offsetLeft;
        var tuesdayOffSet = weekBoxes[1].offsetLeft;
        var wednesdayOffSet = weekBoxes[2].offsetLeft;
        var thursdayOffSet = weekBoxes[3].offsetLeft;
        var fridayOffSet = weekBoxes[4].offsetLeft;
        var saturdayOffSet = weekBoxes[5].offsetLeft;
        var sundayOffSet = weekBoxes[6].offsetLeft;

        var halfView = (viewWidth * 0.5);

        if (vert < 5) {

                if (tuesdayOffSet - halfView < hori && hori < wednesdayOffSet - halfView) {
                weekBoxes[1].scrollIntoView({behavior: "smooth"});
                    }
                else if (wednesdayOffSet - halfView < hori && hori < thursdayOffSet - halfView) {
                weekBoxes[2].scrollIntoView({behavior: "smooth"});
                    }
                else if (thursdayOffSet - halfView < hori && hori < fridayOffSet - halfView) {
                weekBoxes[3].scrollIntoView({behavior: "smooth"});
                    }
                else if (fridayOffSet - halfView < hori && hori < saturdayOffSet - halfView) {
                weekBoxes[4].scrollIntoView({behavior: "smooth"});
                    }
                else if (saturdayOffSet - halfView < hori && hori < sundayOffSet - halfView) {
                weekBoxes[5].scrollIntoView({behavior: "smooth"});
                    }
                else if (sundayOffSet - halfView < hori) {
                weekBoxes[6].scrollIntoView({behavior: "smooth"});
                    }
                else if (hori < tuesdayOffSet - halfView) {
                weekBoxes[0].scrollIntoView({behavior: "smooth"});
                    }
                }
        else {
            if (tuesdayOffSet - halfView < hori && hori < wednesdayOffSet - halfView) {
                weekBoxes[1].scrollIntoView();
                    }
                else if (wednesdayOffSet - halfView < hori && hori < thursdayOffSet - halfView) {
                weekBoxes[2].scrollIntoView();
                    }
                else if (thursdayOffSet - halfView < hori && hori < fridayOffSet - halfView) {
                weekBoxes[3].scrollIntoView();
                    }
                else if (fridayOffSet - halfView < hori && hori < saturdayOffSet - halfView) {
                weekBoxes[4].scrollIntoView();
                    }
                else if (saturdayOffSet - halfView < hori && hori < sundayOffSet - halfView) {
                weekBoxes[5].scrollIntoView();
                    }
                else if (sundayOffSet - halfView < hori) {
                weekBoxes[6].scrollIntoView();
                    }
                else if (hori < tuesdayOffSet - halfView) {
                weekBoxes[0].scrollIntoView();
                    }
                }

                console.log("called, hori = " + hori);
            }

    window.onload = function() {

        var test = document.getElementById("testdiv");

    var TotalElem = document.getElementById('weekView');

    var viewWidth = window.outerWidth;

    var touchStart = 0;

    var touchEnd = 0;

    console.log('outwidth = ' + viewWidth);

    var count = 0;

    document.addEventListener('mouseup', function(event) {
            test.innerHTML += '<br>mouseup event detected';
            }, false);

    document.addEventListener('keypress', function(event2) {
        test.innerHTML += '<br>keypress event detected'
        console.log('got a key press');
    }, false);

    document.addEventListener('keyup', function(event2) {
            test.innerHTML += '<br>keyup detected';
        }, false);

    document.addEventListener('touchmove', function(event) {
        test.innerHTML += '<br>touchmove detected';
        console.log('got a key press');
    }, false);

    document.addEventListener('touchcancel', function(event) {
        test.innerHTML += '<br>touchcancel detected';
    }, false)

    document.addEventListener("touchstart", function(event) {
    test.innerHTML += '<br>touchstart detected. touchstart events = ' + touchStart;
    touchStart++
    }, false);

    document.addEventListener('touchend', onScroller, false);

    testElem(test);

    };

    </script>

    <script type="text/babel">

    /*
        <ul class="panes"> WindowPane
            <li class="list-item"> WeekDay
                <div class="list-content"> PlanWrap
                    <h2>{this.props.day}</h2>
                    <div>{this.state}</div>
    */

   // var data = { name: 'Key Value Pair' };

   var TimeWrap = React.createClass({
        getInitialState: function() {
            return {data: []};
        },
        render: function() {
            return (
                <div className="timeWrap">
                <h4>{this.props.start}</h4>
                <h2>{this.props.children}</h2>
                </div>
                )
        }
   });

    var PlanWrap = React.createClass({
        getInitialState: function() {
            return {text: '', comment: ''};
        },
        render: function() {
            return (
                <div className="planWrap">
                {this.props.children}
                </div>
            )
        }
    });

    var WeekDay = React.createClass({
        getInitialState: function() {
            return {data: []};
        },
        render: function() {
            return (
            <li className="weekDay">
            <h1 className="dayName">{this.props.day}</h1>
            <div>{this.props.children}</div>
            </li>
            );
        }
    });

    var WindowPane = React.createClass({
        loadDaysFromServer: function() {
            $.ajax({
                url: this.props.url,
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    this.setState({data: data});
                }.bind(this),
                error: function(xhr, errorThrown) {
                    console.log(xhr + errorThrown);
                }.bind(this)
            });
        },
        getInitialState: function() {
            return {data: []}
        },
        componentDidMount: function() {
            this.loadDaysFromServer();
        },
        render: function(st) {

            var thisPls = this.state.data;
            var i;


            function mapper() {
                var dayArr = [];
                for (var key in thisPls) {
                    dayArr.push(key.monday);
                }
                return dayArr;
            };

            function mapDay() {
                var finalArr = []

            for (var key in thisPls) {
                var dayTag = key;
                var dayArr = [];
                for (i = 0; i <= thisPls[key].length - 1; i++) 
                    {
                        dayArr.push(<TimeWrap start={thisPls[key][i].start}>{thisPls[key][i].title}</TimeWrap>);
                    }
                    finalArr.push(<WeekDay day={dayTag}><PlanWrap key={thisPls[key][i]}>{dayArr}</PlanWrap></WeekDay>);
                }
                return finalArr; // only returns 
            }

                /*for (j = 0; j <= thisPls[key].length - 1; j++)
                {
                    console.log(thisPls[key][j].end);
                    return "<PlanWrap>{thisPls[key][j].start}</PlanWrap>";
                }

               return (
                <WeekDay end={thisPls[key][0].title}></WeekDay>
                )
            };*/

            var thisdamn = this;

                function mapPls(thisdamn) {

                    var Arrr = [];

                    thisdamn.state.data.map(function(stuff) {
                    Arrr.push(stuff.monday);
                });

                    return Arrr;

            };


            return (

            <div className="windowPane">
                {mapDay()}
            </div>
            );
        }
    });

    ReactDOM.render(
        <WindowPane url="dayinfo.json" text="hello weekday stuff" />,
        document.getElementById('weekView')
        );

    </script>

</head>

<body>
    <div id="testdiv">TEST</div>
    <div id="weekView"></div>

</body>
</html>